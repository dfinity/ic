name: 'Post Commit Status'
description: |
    An action for checking and posting the commit status.
inputs:
  commit-sha:
    required: true
    description: |
      The SHA of the commit to check the status for.
  run-result:
    required: true
    description: |
      The result of the CI main job (success, failure, etc).
  name:
    required: true
    description: |
      The name of the workflow that produced the result.

runs:
  using: "composite"
  steps:      
    - uses: actions/github-script@v7
      with:
        script: |
          let state, description;

          if ('${{ inputs.run-result }}' === 'success') {
            state = 'success';
            description = 'Required checks passed';

          } else if ('${{ inputs.run-result }}' === 'failure') {
            state = 'failure';
            description = 'Required checks failed';

          } else {
            state = 'error';
            description = 'Required checks completed with unexpected result';
          }

          await github.rest.repos.createCommitStatus({
            owner: context.repo.owner,
            repo: context.repo.repo,
            sha: '${{ inputs.commit-sha }}',
            state: state,
            target_url: `${context.serverUrl}/${context.repo.owner}/${context.repo.repo}/actions/runs/${context.runId}`,
            description: description,
            context: '${{ inputs.name }}'
          });
            
          console.log(`Set commit status: ${state} - ${description}`);
