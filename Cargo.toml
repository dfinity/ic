[workspace]

members = [
    "packages/icrc-ledger-agent",
    "packages/icrc-ledger-client",
    "packages/icrc-ledger-client-cdk",
    "packages/icrc-ledger-types",
    "packages/ic-ledger-hash-of",
    "packages/pocket-ic",
    "packages/ic-vetkd-utils",
    "rs/artifact_manager",
    "rs/artifact_pool",
    "rs/async_utils",
    "rs/backup",
    "rs/bazelifier",
    "rs/bitcoin/adapter",
    "rs/bitcoin/client",
    "rs/bitcoin/service",
    "rs/bitcoin/ckbtc/agent",
    "rs/bitcoin/ckbtc/minter",
    "rs/bitcoin/ckbtc/kyt",
    "rs/bitcoin/consensus",
    "rs/bitcoin/mock",
    "rs/bitcoin/types/internal",
    "rs/boundary_node/canary_proxy",
    "rs/boundary_node/certificate_issuance/certificate_issuer",
    "rs/boundary_node/certificate_issuance/certificate_orchestrator",
    "rs/boundary_node/certificate_issuance/certificate_syncer",
    "rs/boundary_node/denylist_updater",
    "rs/boundary_node/discower_bowndary",
    "rs/boundary_node/ic_balance_exporter",
    "rs/boundary_node/ic_boundary",
    "rs/boundary_node/icx_proxy",
    "rs/boundary_node/prober",
    "rs/boundary_node/systemd_journal_gatewayd_shim",
    "rs/canister_client",
    "rs/canister_client/sender",
    "rs/cross-chain/proposal-cli",
    "rs/cycles_account_manager",
    "rs/ethereum/cketh/minter",
    "rs/ethereum/ledger-suite-orchestrator",
    "rs/https_outcalls/adapter",
    "rs/https_outcalls/client",
    "rs/https_outcalls/consensus",
    "rs/https_outcalls/service",
    "rs/canister_sandbox",
    "rs/canonical_state",
    "rs/canonical_state/tree_hash",
    "rs/canonical_state/tree_hash/test_utils",
    "rs/certification",
    "rs/certification/test-utils",
    "rs/config",
    "rs/consensus",
    "rs/consensus/mocks",
    "rs/consensus/utils",
    "rs/constants",
    "rs/criterion_time",
    "rs/crypto",
    "rs/crypto/ecdsa_secp256k1",
    "rs/crypto/ecdsa_secp256r1",
    "rs/crypto/ed25519",
    "rs/crypto/extended_bip32",
    "rs/crypto/for_verification_only",
    "rs/crypto/iccsa",
    "rs/crypto/internal/crypto_lib/basic_sig/der_utils",
    "rs/crypto/internal/crypto_lib/basic_sig/ecdsa_secp256k1",
    "rs/crypto/internal/crypto_lib/basic_sig/ecdsa_secp256r1",
    "rs/crypto/internal/crypto_lib/basic_sig/ed25519",
    "rs/crypto/internal/crypto_lib/basic_sig/iccsa",
    "rs/crypto/internal/crypto_lib/basic_sig/iccsa/test_utils",
    "rs/crypto/internal/crypto_lib/basic_sig/rsa_pkcs1",
    "rs/crypto/internal/crypto_lib/bls12_381/type",
    "rs/crypto/internal/crypto_lib/bls12_381/vetkd",
    "rs/crypto/internal/crypto_lib/hmac",
    "rs/crypto/internal/crypto_lib/multi_sig/bls12_381",
    "rs/crypto/internal/crypto_lib/seed",
    "rs/crypto/internal/crypto_lib/sha2",
    "rs/crypto/secrets_containers",
    "rs/crypto/internal/crypto_lib/threshold_sig/bls12_381",
    "rs/crypto/internal/crypto_lib/threshold_sig/tecdsa",
    "rs/crypto/internal/crypto_lib/threshold_sig/tecdsa/test_utils",
    "rs/crypto/internal/crypto_lib/tls",
    "rs/crypto/internal/crypto_lib/types",
    "rs/crypto/internal/crypto_service_provider",
    "rs/crypto/internal/crypto_service_provider/protobuf_generator",
    "rs/crypto/internal/csp_test_utils",
    "rs/crypto/internal/logmon",
    "rs/crypto/test_utils/reproducible_rng",
    "rs/crypto/internal/test_vectors",
    "rs/crypto/node_key_generation",
    "rs/crypto/node_key_validation",
    "rs/crypto/getrandom_for_wasm",
    "rs/crypto/prng",
    "rs/crypto/sha2",
    "rs/crypto/tecdsa",
    "rs/crypto/temp_crypto",
    "rs/crypto/test_utils",
    "rs/crypto/test_utils/canister_sigs",
    "rs/crypto/test_utils/canister_threshold_sigs",
    "rs/crypto/test_utils/metrics",
    "rs/crypto/test_utils/ni-dkg",
    "rs/crypto/test_utils/tls",
    "rs/crypto/tls_interfaces",
    "rs/crypto/tls_interfaces/mocks",
    "rs/crypto/tree_hash",
    "rs/crypto/tree_hash/test_utils",
    "rs/crypto/utils/basic_sig",
    "rs/crypto/utils/ni_dkg",
    "rs/crypto/utils/threshold_sig",
    "rs/crypto/utils/threshold_sig_der",
    "rs/crypto/utils/tls",
    "rs/cup_explorer",
    "rs/depcheck",
    "rs/drun",
    "rs/recovery",
    "rs/recovery/subnet_splitting",
    "rs/replay",
    "rs/embedders",
    "rs/execution_environment",
    "rs/execution_environment/benches/lib",
    "rs/execution_environment/tools",
    "rs/http_endpoints/public",
    "rs/http_endpoints/metrics",
    "rs/http_utils",
    "rs/ic_os/deterministic_ips",
    "rs/ic_os/dflate",
    "rs/ic_os/diroid",
    "rs/ic_os/config",
    "rs/ic_os/fstrim_tool",
    "rs/ic_os/guestos_tool",
    "rs/ic_os/hostos_tool",
    "rs/ic_os/inject_files",
    "rs/ic_os/launch-single-vm",
    "rs/ic_os/network",
    "rs/ic_os/nss_icos",
    "rs/ic_os/setupos-inject-configuration",
    "rs/ic_os/partition_tools",
    "rs/ic_os/setupos-disable-checks",
    "rs/ic_os/setupos_tool",
    "rs/ic_os/utils",
    "rs/ic_os/vsock/guest",
    "rs/ic_os/vsock/host",
    "rs/ic_os/vsock/vsock_lib",
    "rs/ingress_manager",
    "rs/interfaces",
    "rs/interfaces/adapter_client",
    "rs/interfaces/certified_stream_store",
    "rs/interfaces/certified_stream_store/mocks",
    "rs/interfaces/mocks",
    "rs/interfaces/registry",
    "rs/interfaces/registry/mocks",
    "rs/interfaces/state_manager",
    "rs/interfaces/state_manager/mocks",
    "rs/memory_tracker",
    "rs/messaging",
    "rs/monitoring/adapter_metrics",
    "rs/monitoring/adapter_metrics_service",
    "rs/monitoring/backtrace",
    "rs/monitoring/context_logger",
    "rs/monitoring/logger",
    "rs/monitoring/metrics",
    "rs/monitoring/pprof",
    "rs/nervous_system/clients",
    "rs/nervous_system/collections/union_multi_map",
    "rs/nervous_system/common",
    "rs/nervous_system/common/build_metadata",
    "rs/nervous_system/common/test_canister",
    "rs/nervous_system/common/test_keys",
    "rs/nervous_system/common/test_utils",
    "rs/nervous_system/humanize",
    "rs/nervous_system/integration_tests",
    "rs/nervous_system/lock",
    "rs/nervous_system/neurons_fund",
    "rs/nervous_system/neurons_fund/nfplot",
    "rs/nervous_system/proto",
    "rs/nervous_system/proto/protobuf_generator",
    "rs/nervous_system/proxied_canister_calls_tracker",
    "rs/nervous_system/root",
    "rs/nervous_system/runtime",
    "rs/nervous_system/string",
    "rs/nervous_system/tools/sync-with-released-nevous-system-wasms",
    "rs/nns/constants",
    "rs/nns/common",
    "rs/nns/common/protobuf_generator",
    "rs/nns/cmc",
    "rs/nns/governance",
    "rs/nns/governance/protobuf_generator",
    "rs/nns/handlers/lifeline/impl",
    "rs/nns/handlers/lifeline/interface",
    "rs/nns/handlers/root/impl",
    "rs/nns/handlers/root/impl/protobuf_generator",
    "rs/nns/handlers/root/interface",
    "rs/nns/identity",
    "rs/nns/init",
    "rs/nns/inspector",
    "rs/nns/integration_tests",
    "rs/nns/nns-ui",
    "rs/nns/test_utils",
    "rs/nns/test_utils_macros",
    "rs/nns/gtc",
    "rs/nns/gtc/protobuf_generator",
    "rs/nns/gtc_accounts",
    "rs/nns/sns-wasm",
    "rs/nns/sns-wasm/protobuf_generator",
    "rs/determinism_test",
    "rs/orchestrator",
    "rs/orchestrator/dashboard",
    "rs/orchestrator/registry_replicator",
    "rs/p2p/consensus_manager",
    "rs/p2p/peer_manager",
    "rs/p2p/memory_transport",
    "rs/p2p/quic_transport",
    "rs/p2p/state_sync_manager",
    "rs/p2p/test_utils",
    "rs/replica/setup_ic_network",
    "rs/phantom_newtype",
    "rs/prep",
    "rs/protobuf",
    "rs/protobuf/generator",
    "rs/pocket_ic_server",
    "rs/registry/admin",
    "rs/registry/admin-derive",
    "rs/registry/canister",
    "rs/registry/canister/protobuf_generator",
    "rs/registry/client",
    "rs/registry/fake",
    "rs/registry/helpers",
    "rs/registry/local_registry",
    "rs/registry/local_store",
    "rs/registry/local_store/artifacts",
    "rs/registry/keys",
    "rs/registry/proto",
    "rs/registry/proto/generator",
    "rs/registry/proto_data_provider",
    "rs/registry/provisional_whitelist",
    "rs/registry/regedit",
    "rs/registry/nns_data_provider",
    "rs/registry/nns_data_provider_wrappers",
    "rs/registry/routing_table",
    "rs/registry/subnet_features",
    "rs/registry/subnet_type",
    "rs/registry/transport",
    "rs/registry/transport/protobuf_generator",
    "rs/replica",
    "rs/replica_tests",
    "rs/replicated_state",
    "rs/rosetta-api",
    "rs/rosetta-api/rosetta_core",
    "rs/rosetta-api/icp_ledger",
    "rs/rosetta-api/icp_ledger/archive",
    "rs/rosetta-api/icp_ledger/ledger",
    "rs/rosetta-api/icp_ledger/protobuf_generator",
    "rs/rosetta-api/icp_ledger/index",
    "rs/rosetta-api/icp_ledger/rosetta-integration-tests",
    "rs/rosetta-api/icp_ledger/test_utils",
    "rs/rosetta-api/ledger_core",
    "rs/rosetta-api/ledger_canister_core",
    "rs/rosetta-api/ledger_canister_blocks_synchronizer",
    "rs/rosetta-api/ledger_canister_blocks_synchronizer/test_utils",
    "rs/rosetta-api/icrc1",
    "rs/rosetta-api/icrc1/benchmark/generator",
    "rs/rosetta-api/icrc1/benchmark/worker",
    "rs/rosetta-api/icrc1/index",
    "rs/rosetta-api/icrc1/index-ng",
    "rs/rosetta-api/icrc1/ledger",
    "rs/rosetta-api/icrc1/rosetta",
    "rs/rosetta-api/icrc1/rosetta/client",
    "rs/rosetta-api/icrc1/rosetta/runner",
    "rs/rosetta-api/icrc1/ledger/sm-tests",
    "rs/rosetta-api/icrc1/archive",
    "rs/rosetta-api/icrc1/test_utils",
    "rs/rosetta-api/icrc1/tokens_u64",
    "rs/rosetta-api/icrc1/tokens_u256",
    "rs/rosetta-api/hardware_wallet_tests",
    "rs/rosetta-api/test_utils",
    "rs/rosetta-api/tvl",
    "rs/rosetta-api/tvl/xrc_mock",
    "rs/rust_canisters/call_tree_test",
    "rs/rust_canisters/canister_creator",
    "rs/rust_canisters/canister_log",
    "rs/rust_canisters/canister_serve",
    "rs/rust_canisters/canister_test",
    "rs/rust_canisters/dfn_core",
    "rs/rust_canisters/dfn_candid",
    "rs/rust_canisters/dfn_http",
    "rs/rust_canisters/dfn_http_metrics",
    "rs/rust_canisters/dfn_json",
    "rs/rust_canisters/dfn_macro",
    "rs/rust_canisters/dfn_protobuf",
    "rs/rust_canisters/downstream_calls_test",
    "rs/rust_canisters/ecdsa",
    "rs/rust_canisters/http_types",
    "rs/rust_canisters/memory_test",
    "rs/rust_canisters/on_wire",
    "rs/rust_canisters/pmap",
    "rs/rust_canisters/proxy_canister",
    "rs/rust_canisters/response_payload_test",
    "rs/rust_canisters/stable_reader",
    "rs/rust_canisters/stable_structures",
    "rs/rust_canisters/statesync_test",
    "rs/rust_canisters/tests",
    "rs/rust_canisters/xnet_test",
    "rs/scenario_tests",
    "rs/sns/audit",
    "rs/sns/cli",
    "rs/sns/governance",
    "rs/sns/governance/proposal_criticality",
    "rs/sns/governance/protobuf_generator",
    "rs/sns/governance/token_valuation",
    "rs/sns/governance/proposals_amount_total_limit",
    "rs/sns/init",
    "rs/sns/init/protobuf_generator",
    "rs/sns/integration_tests",
    "rs/sns/root",
    "rs/sns/root/protobuf_generator",
    "rs/sns/swap",
    "rs/sns/swap/proto_library",
    "rs/sns/test_utils",
    "rs/starter",
    "rs/state_manager",
    "rs/state_machine_tests",
    "rs/state_layout",
    "rs/state_tool",
    "rs/sys",
    "rs/system_api",
    "rs/test_utilities",
    "rs/test_utilities/artifact_pool",
    "rs/test_utilities/consensus",
    "rs/test_utilities/execution_environment",
    "rs/test_utilities/load_wasm",
    "rs/test_utilities/compare_dirs",
    "rs/test_utilities/logger",
    "rs/test_utilities/metrics",
    "rs/test_utilities/serialization",
    "rs/test_utilities/state",
    "rs/test_utilities/time",
    "rs/test_utilities/types",
    "rs/test_utilities/tmpdir",
    "rs/tests",
    "rs/tests/httpbin-rs",
    "rs/tests/networking/canister_http",
    "rs/tests/nested",
    "rs/tests/nns/sns",
    "rs/tests/nns/ic_mainnet_nns_recovery",
    "rs/tests/sdk",
    "rs/tests/test_canisters/http_counter",
    "rs/tests/test_canisters/kv_store",
    "rs/tests/test_canisters/message",
    "rs/tests/testing_verification",
    "rs/tests/testing_verification/wabt-tests",
    "rs/tests/testing_verification/spec_compliance",
    "rs/tests/testing_verification/testnets",
    "rs/tree_deserializer",
    "rs/types/types",
    "rs/types/types_test_utils",
    "rs/types/base_types",
    "rs/types/base_types/protobuf_generator",
    "rs/types/error_types",
    "rs/types/management_canister_types",
    "rs/types/wasm_types",
    "rs/universal_canister/lib",
    "rs/utils",
    "rs/utils/ensure",
    "rs/utils/lru_cache",
    "rs/utils/rustfmt",
    "rs/validator",
    "rs/validator/ingress_message",
    "rs/validator/ingress_message/test_canister",
    "rs/workload_generator",
    "rs/xnet/endpoint",
    "rs/xnet/hyper",
    "rs/xnet/payload_builder",
    "rs/xnet/uri",
]

resolver = "2"

exclude = ["universal_canister/impl"]

[workspace.package]
version = "0.9.0"
authors = ["The Internet Computer Project Developers"]
description = "Autonomous serverless cloud functionality for the public Internet."
documentation = "https://internetcomputer.org/docs/"
edition = "2021"

[profile.release]
# Add debug information to the release build (does NOT reduce the level of optimization!)
# Makes flamegraphs more readable.
# https://doc.rust-lang.org/cargo/reference/manifest.html#the-profile-sections
debug = true

[profile.release-stripped]
inherits = "release"
lto = "thin"
debug = false

[profile.release-lto]
inherits = "release"
# Enable "thin" LTO to reduce both the compilation time and the binary size.
# See: https://doc.rust-lang.org/cargo/reference/profiles.html#lto
lto = "thin"

[profile.canister-release]
inherits = "release"
debug = false
lto = true
opt-level = 'z'

[profile.dev.package.curve25519-dalek]
opt-level = 3

[profile.dev.package.ic_bls12_381]
opt-level = 3

[profile.dev.package.k256]
opt-level = 3

[profile.dev.package.p256]
opt-level = 3

[patch.crates-io]
# Current jsonrpc version (0.12.1) does not support ipv6 addressing. When new version is
# released this can be removed.
jsonrpc = { git = "https://github.com/apoelstra/rust-jsonrpc", rev = "e42044d" }

[workspace.dependencies]
anyhow = "1.0.80"
arrayvec = "0.7.4"
askama = { version = "0.12.1", features = ["serde-json"] }
assert_matches = "1.5.0"
async-recursion = "1.0.5"
async-trait = "0.1"
async-scoped = { version = "0.8", features = ["use-tokio"] }
axum = { version = "0.7.4", features = ["json"] }
backoff = "0.4"
base64 = { version = "0.13.1" }
# build-info and build-info-build MUST be kept in sync!
build-info = { git = "https://github.com/dfinity-lab/build-info", rev = "701a696844fba5c87df162fbbc1ccef96f27c9d7" }
build-info-build = { git = "https://github.com/dfinity-lab/build-info", rev = "701a696844fba5c87df162fbbc1ccef96f27c9d7", default_features = false }
bytes = "1.6.0"
candid = { version = "0.10.6" }
candid_parser = { version = "0.1.2" }
chrono = { version = "0.4.31", default-features = false, features = [
    "alloc",
    "clock",
    "serde",
] }
ciborium = "0.2.1"
clap = { version = "4.4.6", features = ["derive", "string"] }
cloudflare = { version = "0.9.1", default_features = false, features = [
    "rustls-tls",
] }
crossbeam-channel = "0.5.11"
curve25519-dalek = "4.1.2"
ethnum = { version = "1.3.2", features = ["serde"] }
flate2 = "1.0.28"
futures = "0.3.30"
futures-util = "0.3.30"
hex = { version = "0.4.3", features = ["serde"] }
hyper = { version = "1.2.0", features = ["full"] }
hyper-rustls = { version = "0.24.2", features = ["http2"] }
hyper-socks2 = { version = "0.8.0", default_features = false, features = [
    "rustls",
] }
ic-agent = { version = "0.35.0", features = ["hyper"] }
ic-cdk = "0.13.2"
ic-cdk-macros = "0.9.0"
ic-cdk-timers = "0.7.0"
ic_principal = { version = "0.1.1", default-features = false }
ic-response-verification = "2.3.0"
ic-http-certification = "2.3.0"
ic-certification = "2.3.0"
ic-cbor = "2.3.0"
ic-stable-structures = "0.6.4"
ic-utils = { version = "0.35.0", features = ["raw"] }
ic-btc-interface = { git = "https://github.com/dfinity/bitcoin-canister", rev = "62a71e47c491fb842ccc257b1c675651501f4b82" }
ic-btc-validation = { git = "https://github.com/dfinity/bitcoin-canister", rev = "0e996988693f2d55fc9533c44dc20ae5310a1894" }
ic-btc-test-utils = { git = "https://github.com/dfinity/bitcoin-canister", rev = "62a71e47c491fb842ccc257b1c675651501f4b82" }
indexmap = "2.1.0"
itertools = "0.12.0"
k256 = { version = "0.13.3", default_features = false, features = [
    "arithmetic",
    "ecdsa",
    "pem",
    "pkcs8",
    "precomputed-tables",
    "schnorr",
    "std",
] }
libnss = "0.5.0"
local-ip-address = "0.5.6"
mockall = "0.11.4"
mockito = "1.2.0"
minicbor = { version = "0.19.1", features = ["alloc", "derive"] }
minicbor-derive = "0.13.0"
nix = "0.24.3"
num-traits = { version = "0.2.14", features = ["libm"] }
p256 = { version = "0.13", default_features = false, features = [
    "arithmetic",
    "ecdsa",
    "pem",
    "pkcs8",
] }
ping = "0.5.0"
pkcs8 = "0.10.2"
pretty_assertions = "1.4.0"
prometheus = { version = "0.13.3", features = ["process"] }
prost = "0.12.3"
prost-build = "0.12.3"
quinn = { version = "0.10.2", features = ["ring"] }
rand = "0.8.5"
rcgen = { version = "0.11.1", features = ["zeroize"] }
reqwest = { version = "0.12.3", default-features = false, features = [
    "blocking",
    "http2",
    "json",
    "rustls-tls",
    "rustls-tls-native-roots",
    "socks",
    "stream",
] }
rstest = "0.19.0"
rustls = { version = "0.23.8", default-features = false, features = ["ring", "logging", "tls12"] }
serde = { version = "1.0", features = ["derive"] }
serde_bytes = "0.11"
serde_cbor = "0.11.2"
serde_derive = "1.0"
serde_json = { version = "1.0.107", features = ["std"] }
serde_with = "1.14.0"
serde_yaml = "0.9.29"
signature = "2.1.0"
simple_asn1 = "0.6.2"
slog = { version = "2.7.0", features = [
    "max_level_trace",
    "nested-values",
    "release_max_level_debug",
    "release_max_level_trace",
] }
socket2 = { version = "0.5.6", features = ["all"] }
strum = { version = "0.26.2", features = ["derive"] }
strum_macros = "0.26.2"
syn = { version = "1.0.109", features = ["fold", "full"] }
sync_wrapper = "^1.0.1"
tempfile = "^3.1.0"
thiserror = "1.0.57"
time = { version = "0.3.20", features = ["formatting"] }
tokio = { version = "1.37.0", features = ["full"] }
tokio-metrics = "0.3.0"
tokio-rustls = { version = "0.24.1", features = ["dangerous_configuration"] }
tokio-util = { version = "0.7.10", features = ["full"] }
tonic = "0.11.0"
tonic-build = "0.11.0"
tower = { version = "0.4.13", features = ["full"] }
tracing = "0.1.40"
tracing-appender = "0.2.3"
tracing-subscriber = { version = "0.3.18", features = [
    "env-filter",
    "fmt",
    "json",
] }
turmoil = "0.6.0"
x509-cert = { version = "0.2.4", features = ["builder", "hazmat"] }
x509-parser = { version = "0.15.1" }

[workspace.dependencies.ic-wasm]
version = "^0.7.1"
default-features = false
features = ["exe"]
