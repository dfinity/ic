= Introducing a new Management Canister API or changing an existing one:

1. Specify the new API or make the required changes to an existing one in the [portal](https://github.com/dfinity/portal) repository. Typically, you would want to make changes in the [following file](https://github.com/dfinity/portal/blob/master/docs/references/ic-interface-spec.md). Additionally, make sure you update the [Candid interface](https://github.com/dfinity/portal/blob/master/docs/references/_attachments/ic.did) of the Management Canister accordingly. Furthermore, make sure to provide motivation for the new API or changes you're making and how it would benefit the ICP protocol.
2. The public Management Canister [types](https://crates.io/crates/ic-management-canister-types) needs to be updated. Inform *@eng-sdk* of the work required.
3. The Rust CDK needs to be updated: [Rust Canister Development Kit](https://github.com/dfinity/cdk-rs). Inform *@eng-sdk* of the work required.
4. Motoko needs to be updated: [Motoko](https://github.com/dfinity/motoko). Inform *@eng-motoko* of the work required.
5. Add any new types or update existing ones in `types/management_canister_types`.
6. Implement the new API in `execution_environment` crate. Main parts that need to be updated: the core implementation in the `canister_manager` module as well as wiring up the new API in `ExecutionEnvironment` so that it is accessible from the outside.
Except for the `install_code`/`install_chunked_code` endpoints that have dedicated logic for dealing with rollback after failures, there should always be a clear point during execution of every other endpoint so that
  - no changes are performed before that point (only `&self` access to `CanisterManager`);
  - no failure can happen after that point (the execution is guaranteed to succeed and return a reply).
7. Tests: add any required tests to cover the new or updated functionality. Typically, these tests can be written using the `ExecutionTest` framework. In some cases, you might need to use the `StateMachine` framework, e.g., if you would need to test things like inter-canister calls or special features like HTTPS outcalls or threshold signatures that require (mocked) outputs of the Consensus layer to be injected in the test or checkpointing that requires a state manager provided by the `StateMachine` framework.
8. Once the *Interface Spec* PR has been agreed on, the public Management Canister [types](https://crates.io/crates/ic-management-canister-types), [Motoko](https://github.com/dfinity/motoko) and [Rust CDK](https://github.com/dfinity/cdk-rs) can be updated to use the new API on a feature branch. Coordinate with *@eng-sdk* and *@eng-motoko* as needed.
9. Once the implementation is rolled out fully on mainnet, the Interface Spec PR, public Management Canister types, Rust CDK, and Motoko changes can be merged to master.
