load("@rules_rust//rust:defs.bzl", "rust_library", "rust_test", "rust_binary")

package(default_visibility = ["//rs:ic-os-pkg"])

DEPENDENCIES = [
    # Keep sorted.
    "//rs/ic_os/config_types",
    "@crate_index//:macaddr",
    "@crate_index//:serde",
    "@crate_index//:serde_json",
    "@crate_index//:url",
]

rust_library(
    name = "config_types_compatibility_tests",
    srcs = glob(
        ["src/**/*.rs"],
        exclude = ["src/bin/**/*.rs"],
    ),
    crate_name = "config_types_compatibility_tests",
    visibility = ["//rs:ic-os-pkg"],
    deps = DEPENDENCIES,
)

filegroup(
    name = "fixtures_dir",
    srcs = glob(["fixtures/**/*"]),
    visibility = ["//visibility:public"],
)

rust_binary(
    name = "generate_config_fixture",
    srcs = ["src/bin/generate_config_fixture.rs"],
    crate_name = "generate_config_fixture",
    visibility = ["//rs:ic-os-pkg"],
    deps = [
        ":config_types_compatibility_tests",
        "//rs/ic_os/config_types",
    ],
)

rust_test(
    name = "compatibility_tests",
    srcs = ["tests/compatibility_tests.rs"],
    crate_name = "compatibility_tests",
    deps = [
        ":config_types_compatibility_tests",
        "//rs/ic_os/config_types",
        "@crate_index//:serde_json",
    ],
)

# Add a test target that can be run from the config_types package
rust_test(
    name = "config_types_compatibility_test",
    srcs = ["tests/compatibility_tests.rs"],
    crate_name = "config_types_compatibility_test",
    deps = [
        ":config_types_compatibility_tests",
        "//rs/ic_os/config_types",
        "@crate_index//:serde_json",
    ],
) 